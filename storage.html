<html>
  <head>
    <title>Timer</title>
    <link href="css/storage-page.css" rel="stylesheet" media="screen">
    <script src="node_modules/moment/moment.js"></script>
  </head>
  <body>
    <div class="activities-container">
      <h1>Registered activities</h1>
      <div id="activities">
      </div>
    </div>
  </body>
  <script type="text/javascript">
    var ipcRenderer = require('electron').ipcRenderer;
    ipcRenderer.on('storerage-cotent', createTable);
    ipcRenderer.send('storage-view-ready');

    function createTable (event, content) {
      var activities = document.getElementById('activities');
      var _div_ = document.createElement('div');
      var _span_ = document.createElement('span');

      var list = _div_.cloneNode(false);
      list.className = 'list'

      var days = Object.keys(content).sort(function(a, b) {
          return a > b ? -1 : 1;
      });

      days.forEach(function(day) {
        var listItem = _div_.cloneNode(false);
        listItem.className = 'list-item'

        var dayFormatted = moment(day).format('YYYY-MM-DD');
        var listItemDay = _div_.cloneNode(false);
        listItemDay.className = 'list-item-day'
        listItemDay.innerHTML = dayFormatted

        listItem.appendChild(listItemDay)

        var listItemTagsTime = _div_.cloneNode(false);
        listItemTagsTime.className = 'list-item-tags-time'

        var total = 0
        content[day].forEach(function(activity, key) {

          total += (parseInt(activity.minutes) || 0)

          var entry = _div_.cloneNode(false);
          var tag = _span_.cloneNode(false);
          var time = _span_.cloneNode(false);

          tag.innerHTML = activity.tag
          time.innerHTML = activity.minutes

          entry.appendChild(tag)
          entry.appendChild(time)
          listItemTagsTime.appendChild(entry)
        })

        var entryTotal = _div_.cloneNode(false);
        entryTotal.className = 'total'
        var tag = _span_.cloneNode(false);
        var time = _span_.cloneNode(false);
        tag.innerHTML = 'total'

        var hours = Math.floor(total/60)
        var minutes = total - (60 * hours)

        time.innerHTML = `${total} mins / ${hours}:${minutes < 10 ? '0'+minutes : minutes} hs`
        entryTotal.appendChild(tag)
        entryTotal.appendChild(time)
        listItemTagsTime.appendChild(entryTotal)

        listItem.appendChild(listItemTagsTime)
        list.appendChild(listItem)
      })

      activities.appendChild(list)
    }
  </script>
</html>
